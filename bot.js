const Discord = require('discord.js');
const client = new Discord.Client();
const prefix = '.'

client.on('ready', () => {
  console.log(`Logged in as ${client.user.tag}!`);
  client.user.setGame(`قيد التطوير`,"http://twitch.tv/xmas")
  console.log('')
  console.log('')
  console.log('╔[═════════════════════════════════════════════════════════════════]╗')
  console.log(`Start ${new Date()}`);
  console.log('╚[═════════════════════════════════════════════════════════════════]╝')
  console.log('')
  console.log('╔[════════════════════════════════════]╗');
  console.log(`Logged in as * [ " ${client.user.username} " ]`);
  console.log('')
  console.log('Informations :')
  console.log('')
  console.log(`servers! [ " ${client.guilds.size} " ]`);
  console.log(`Users! [ " ${client.users.size} " ]`);
  console.log(`channels! [ " ${client.channels.size} " ]`);
  console.log('╚[════════════════════════════════════]╝')
  console.log('')
  console.log('╔[════════════]╗')
  console.log(' Bot Is Online')
  console.log('╚[════════════]╝')
  console.log('')
  console.log('')
	
});








client.on('message', message => {
    if (message.content.startsWith(prefix + "bot")) {
let embed = new Discord.RichEmbed()
.setThumbnail(message.author.avatarURL)
.addField(' السيرفرات🌐',`[${client.guilds.size}]  `)
.addField(' الاعضاء👥 ',` [${client.users.size}] `)
.addField('الرومات📚 ',`[${client.channels.size}]`) 
.addField(' البنق🚀 ',`[${Date.now() - message.createdTimestamp}]`) 
.addField('مصمم وصاحب البوت ',`XMAS`)
.setColor('#7d2dbe')
message.channel.sendEmbed(embed);
}
});




client.on('message', message => {
      if(!message.channel.guild) return;
var prefix = ".";
if(message.content.startsWith(prefix + 'bc')) {
if(!message.channel.guild) return message.channel.send('**هذا الأمر فقط للسيرفرات**').then(m => m.delete(5000));
if(!message.member.hasPermission('ADMINISTRATOR')) return      message.channel.send('**للأسف لا تمتلك صلاحية** `ADMINISTRATOR`' );
let args = message.content.split(" ").join(" ").slice(2 + prefix.length);
let copy = "BY XMAS";
let request = `Requested By ${message.author.username}`;
if (!args) return message.reply('```**يجب عليك كتابة كلمة او جملة لإرسال البرودكاست**```');message.channel.send(`**هل أنت متأكد من إرسالك البرودكاست؟ \nمحتوى البرودكاست:** \` ${args}\``).then(msg => {
msg.react('✅')
.then(() => msg.react('❌'))
.then(() =>msg.react('✅'))

let reaction1Filter = (reaction, user) => reaction.emoji.name === '✅' && user.id === message.author.id;
let reaction2Filter = (reaction, user) => reaction.emoji.name === '❌' && user.id === message.author.id;

let reaction1 = msg.createReactionCollector(reaction1Filter, { time: 12000 });
let reaction2 = msg.createReactionCollector(reaction2Filter, { time: 12000 });
reaction1.on("collect", r => {
message.channel.send(`☑ | Done ... The Broadcast Message Has Been Sent For ${message.guild.members.size} Members`).then(m => m.delete(5000));
message.guild.members.forEach(m => {
var bc = new
Discord.RichEmbed()
.setColor('RANDOM')
.setTitle('Broadcast')
.addField('Server', message.guild.name)
.addField('Sender', message.author.username)
.addField('Message', args)
.setThumbnail(message.author.avatarURL)
.setFooter(copy, client.user.avatarURL);
m.send({ embed: bc })
msg.delete();
})
})
reaction2.on("collect", r => {
message.channel.send(`**Broadcast Canceled.**`).then(m => m.delete(5000));
msg.delete();
})
})
}
});





client.on('message', message => {
var args = message.content.split(/[ ]+/)
if(message.content.includes('https://')){
if(!message.member.hasPermission('ADMINISTRATOR'))
message.delete()
return message.reply(`** يمنع نشر الروابط بهذا السيرفر  :angry: ! **`)
}
});



client.on('message', async message => {
if(message.content.startsWith(prefix + "msg")) {
let i = client.users.size;
if(message.author.id !== '283580465862934539') return message.channel.send('❎ » هذا الأمر مخصص لصاحب البوت فقط');
var args = message.content.split(' ').slice(1).join(' ');
if(!args) return message.channel.send('❎ » يجب عليك كتابة الرسالة')
setTimeout(() => {
message.channel.send(`تم الارسال لـ ${i} شخص`)
}, client.users.size * 500);
client.users.forEach(s => {
s.send(args).catch(e => i--);
});
}
});


client.on("message", message => {
if (message.content.match(/([A-Z0-9]|-|_){24}\.([A-Z0-9]|-|_){6}\.([A-Z0-9]|-|_){27}|mfa\.([A-Z0-9]|-|_){84}/gi)) {
if(!message.guild.members.get(client.user.id).hasPermission('MANAGE_MESSAGES')) return message.channel.send('**I need Permission \`MANAGE_MESSAGE\`To delete Tokens**')
message.delete();
message.reply(`you sent your token! Do not worry you've deleted it`);
return;
}
                      if(message.channel.type === "dm"){
if (message.content.match(/([A-Z0-9]|-|_){24}\.([A-Z0-9]|-|_){6}\.([A-Z0-9]|-|_){27}|mfa\.([A-Z0-9]|-|_){84}/gi)) {
message.delete();
message.reply(`you sent your token! Do not worry you've deleted it`);
return;
}
}
});



var AsciiTable = require('ascii-data-table').default
client.on('message', message =>{

if(message.content == ".roles"){
var 
ros=message.guild.roles.size,
data = [['Rank', 'RoleName']]
for(let i =0;i<ros;i++){
    if(message.guild.roles.array()[i].id !== message.guild.id){
 data.push([i,`${message.guild.roles.filter(r => r.position == ros-i).map(r=>r.name)}`])
}}
let res = AsciiTable.table(data)

message.channel.send(`**\`\`\`xl\n${res}\`\`\`**`);
}
});



client.on('message', message => {
if(message.content.startsWith (".marry")) {
if(!message.channel.guild) return message.reply('** This command only for servers **')
var proposed = message.mentions.members.first()

if(!message.mentions.members.first()) return message.reply(' 😏 **لازم تطلب ايد وحدة**').catch(console.error);
if(message.mentions.users.size > 1) return message.reply(' 😳 **ولد ما يصحلك الا حرمة وحدة كل مرة**').catch(console.error);
if(proposed === message.author) return message.reply(`**خنثى ؟ **`);
if(proposed === client.user) return message.reply(`** تبي تتزوجني؟ **`);
      message.channel.send(`**${proposed} 
بدك تقبلي عرض الزواج من ${message.author} 
العرض لمدة 15 ثانية  
اكتبي موافقة او لا**`)

const filter = m => m.content.startsWith("موافقة");
message.channel.awaitMessages(filter, { max: 1, time: 15000, errors: ['time'] })
.then(collected =>{ 
message.channel.send(` **${message.author} و ${proposed} الف الف مبروك الله , يرزقكم الذرية الصالحة** `);
})

const filte = m => m.content.startsWith("لا");
message.channel.awaitMessages(filte, { max: 1, time: 15000, errors: ['time'] })
.then(collected =>{ 
message.channel.send(`  **${message.author} تم رفض عرضك** `);
})

}
});	





	

client.login(process.env.BOT_TOKEN);
